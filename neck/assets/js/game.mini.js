const _shuffle=t=>{for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},_randomColor=()=>"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")",_ROTATIONS=()=>_shuffle([0,0,45,45,45,45,-45,-45,-45,-45]),_GAME_STATE={isEnterVR:!1,isPositionSet:!1,isGameStart:!1,isSuccess:{},BGM:document.querySelector("#sound-bgm"),successSound:document.querySelector("#sound-success"),missedSound:document.querySelector("#sound-missed"),controlPanel:document.querySelector("[control-panel]"),camera:document.querySelector("[camera]"),mask:document.querySelector("#model-mask"),maskInitPosition:new THREE.Vector3(0,0,-4),maskZRotations:_ROTATIONS(),currentRotation:0,gameScore:0,gameScoreBoard:document.querySelector("#gameScore"),resetMask:function(){console.log("Reset object"),this.currentRotation=this.maskZRotations.pop(),this.mask.setAttribute("rotation","0 0 "+90*Math.random());var t=this.maskInitPosition;t.x=2*(Math.random()-.5),t.z=-4,this.mask.setAttribute("position",t),this.mask.querySelector("a-dodecahedron").setAttribute("color","rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"),this.mask.setAttribute("visible",!0),this.mask.emit("gametick",null,!1)},startGame:function(){this.isGameStart=!0,this.controlPanel.setAttribute("visible",!1),this.BGM.components.sound.playSound(),this.resetMask()},endGame:function(){this.isGameStart=!1,this.controlPanel.setAttribute("visible",!0),this.mask.setAttribute("visible",!1),this.BGM.components.sound.stopSound(),this.maskZRotations=_ROTATIONS(),this.isSuccess={},this.gameScoreBoard.setAttribute("visible","true"),this.gameScoreBoard.querySelector("a-text").setAttribute("value",`Score: ${this.gameScore}`),this.gameScore=0},response:function(t){return console.log(t),0===this.currentRotation?Math.abs(t)<5:t>0&&t>=this.currentRotation||t<0&&t<=this.currentRotation}};_GAME_STATE.mask.addEventListener("click",(t=>{_GAME_STATE.gameScore+=10,console.log("Hit",_GAME_STATE.gameScore),_GAME_STATE.successSound.components.sound.playSound(),_GAME_STATE.resetMask()})),AFRAME.registerComponent("startgame-btn",{init:function(){this.el.sceneEl;this.el.addEventListener("click",(()=>{_GAME_STATE.isGameStart||_GAME_STATE.startGame()})),_GAME_STATE.mask.addEventListener("animationcomplete",(function(){_GAME_STATE.maskZRotations.length<=0?(_GAME_STATE.endGame(),console.log("Game Over")):(console.log("miss"),_GAME_STATE.missedSound.components.sound.playSound(),_GAME_STATE.resetMask())}))}}),AFRAME.registerComponent("rotation-reader",{init:function(){this.initialRotation=this.el.object3D.rotation.clone(),this.initialPosition=this.el.object3D.position.clone()},tick:function(){_GAME_STATE.mask.getAttribute("position");if(_GAME_STATE.isEnterVR&&!_GAME_STATE.isPositionSet){var t=new THREE.Vector3;this.cameraWorldPosition=this.el.object3D.getWorldPosition(t),console.log("Set position",this.cameraWorldPosition),this.cameraWorldPosition.y>0&&(_GAME_STATE.controlPanel.object3D.position.y=this.cameraWorldPosition.y,_GAME_STATE.maskInitPosition.y=this.cameraWorldPosition.y,_GAME_STATE.isPositionSet=!0)}}});
